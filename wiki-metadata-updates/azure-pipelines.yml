trigger: none   # run manually for testing

# --- External repos you want to pull in ---
resources:
  repositories:
  - repository: wikiRepo                # alias you choose
    type: git
    name: yourOrg/yourProject/yourWikiRepo   # full path: org/project/repo
    ref: refs/heads/feature/my-branch   # branch you want to target
    #Uncomment to trigger on specific folder
    #trigger:
    #  branches:
    #    include:
    #      - my-branch
    #  paths:
    #    include:
    #      - Wiki-Root/sub-dir/trigger-folder/**  #** is required for folder trigger

# --- Pipeline variables (inputs to your script) ---
variables:
  repoRoot: '$(Build.SourcesDirectory)/wikiRepo' #Identifies pipeline automation directory
  excludeDirs: 'Archive,Templates'
  backupMode: 'Create'
  dictLink: '/Wiki/Wiki-Root/Tags/Tag_Dictionary.md'
  dictWritePath: 'Tags/Tag_Dictionary.md'
  repoBranch: 'refs/heads/my-branch

pool:
  vmImage: 'windows-latest'

steps:
# --- Checkout repos ---
- checkout: self
- checkout: wikiRepo
  persistCredentials: true   # needed if you plan to push changes back

# --- Run your PowerShell script ---
- task: PowerShell@2
  displayName: 'Update metadata markdown headers and footers'
  inputs:
    filePath: scripts/Update-Markdown.ps1
    arguments: >
      -repoRoot "$(repoRoot)"
      -excludeDirs "$(excludeDirs)"
      -backupMode "$(backupMode)"
      -dictLink "$(dictLink)"
      -dictWritePath "$(dictWritePath)"

# --- (Optional) Commit and push changes back ---
- script: |
    cd $(repoRoot)
    git config user.email "buildagent@yourorg.com"
    git config user.name "Build Agent"
    git add .
    git commit -m "Automated update of markdown headers/footers [skip ci]" || echo "No changes to commit"
    git push origin HEAD:feature/my-branch
  displayName: 'Commit and push changes'

  - publish: '$(repoRoot)/Metadata/Tag_Update.log'
    artifact: update-log
